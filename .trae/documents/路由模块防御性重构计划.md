# Vercel 500 启动崩溃终极修复计划

**现状分析：**
尽管我们已经对 `cv2` 和 `scheduler` 做了隔离，但 Vercel 依然报 500 错误。这意味着仍有文件在**导入阶段**触发了不可恢复的错误。
通过排查，我发现 `app/api/routes/attractions.py` 是另一个潜在的高风险点。它直接导入了大量业务逻辑模块。在 Vercel 的极端环境下，任何一个依赖（比如 AHP 计算器或 CRUD 模块）如果加载失败，都会导致整个路由文件加载失败，进而导致 `main.py` 导入路由时崩溃。

**核心策略：**
不仅仅是“修复错误”，而是要实现**“部分可用”**。我们要确保即使某些功能模块完全损坏，`main.py` 依然能成功启动，至少让用户看到首页或 `/health` 接口，而不是 500 页面。

## 实施步骤

### 1. 路由模块防御性重构
- **目标文件**: `app/api/routes/attractions.py` (已完成), 以及其他所有路由文件。
- **操作**: 将所有 `from app.db...` 和 `from app.services...` 的导入语句放入 `try-except ImportError` 块中。如果导入失败，不仅不崩溃，还可以定义一个 Mock 对象，防止后续代码引用报错。

### 2. `main.py` 路由加载隔离
- **目标文件**: `app/main.py` (已完成)。
- **操作**: 确保每个 `app.include_router` 都是独立的，并且都被 `try-except` 包裹。这样，坏掉的路由只会导致该路径 404，而不会导致整个服务 500。

### 3. 验证与监控
- 代码推送后，通过访问 `/health` 接口来验证服务是否存活。
- 如果 `/health` 能返回 `{"status": "ok"}`，说明核心启动成功。之后再逐个检查 `/api/attractions` 等接口是否可用。

**当前进度：**
我已经完成了 `attractions.py` 的防御性修改并推送了代码。请等待部署完成。如果这次还不行，我们将继续排查 `community.py` 和 `user.py` 等其他路由文件，直到找出那个“害群之马”。
